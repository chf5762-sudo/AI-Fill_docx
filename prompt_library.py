# -*- coding: utf-8 -*-
"""
提示词参考库
包含各类文档处理场景的预设提示词模板
"""

# ==================== 默认模板（主界面快速应用用） ====================
DEFAULT_TEMPLATES = {
    "商务合同": {
        "prompt": """这是一份商务合同文档。请特别注意：

【合同主体信息】
- 甲方/乙方公司全称（必须完整，不能简写）
- 法定代表人姓名
- 统一社会信用代码（18位）
- 注册地址（完整详细地址）
- 联系人、联系电话、邮箱

【财务关键信息】
- 合同金额（大写和小写都要提取）
- 付款方式（如：预付30%、货到付款等）
- 付款账期（如：30天、60天）
- 开户行全称、银行账号
- 税率、发票类型

【时间节点】
- 合同签订日期、生效日期、交货日期
- 验收期限、质保期、合同有效期

【业务条款】
- 产品/服务名称及规格、数量和单位
- 单价、技术标准、交付地点

【特别提醒】
- 金额数字不能出错，小数点位置要准确
- 日期格式保持一致
- 公司名称不能有错别字
- 账号不能多一位或少一位""",
        "enabled": False,
        "description": "适用于采购合同、销售合同、服务协议等"
    },
    
    "技术文档": {
        "prompt": """这是一份技术相关文档。请特别注意：

【物料/产品信息】
- 物料编号（如：MTR-2024-0001）
- 产品型号（如：SKY13286-359LF、STM32F103C8T6）
  * 保持完整，不要截断
  * 字母大小写、横杠、数字都要准确
- 产品名称、品牌/制造商、产地

【规格参数】（关键！）
电气参数：工作电压、工作电流、功率、频率
物理参数：尺寸、重量、温度范围、湿度范围
性能参数：精度、分辨率、灵敏度、带宽

【版本与批次】
- 硬件版本（如：V1.0、V2.3、Rev.A）
- 软件版本、生产批次、序列号

【数量与单位】（必须准确！）
- 数量：1、10、100、1000
- 单位：个、只、台、套、pcs、EA、米、kg等
- 包装规格（如：50个/盒，10盒/箱）

【特别提醒】
- 型号中的字母O和数字0要区分清楚
- 型号中的字母I和数字1要区分清楚
- 单位换算要准确（1A=1000mA）
- 温度符号℃不要写成°C或C""",
        "enabled": False,
        "description": "适用于BOM清单、技术规格书、产品说明书等"
    },
    
    "通用模板": {
        "prompt": """这是一份通用文档。请：

【基本信息优先】
- 人名/公司名（出现在文档中的所有实体）
- 联系方式（电话、手机、传真、邮箱）
- 地址信息（完整详细地址、邮编）
- 日期信息（所有出现的日期）
- 编号信息（文档编号、项目编号等）

【数值信息】
- 金额（含货币符号：¥、$、€等）
- 数量（含单位）
- 百分比
- 时间段（如：3个月、30天）

【提取原则】
1. 宁可多提取，不要遗漏
2. 保持原文表述，不要改写
3. 不确定的信息也要提取，但标注"待确认"
4. 重复出现的信息只提取一次
5. 注意上下文关系，正确理解信息含义""",
        "enabled": False,
        "description": "适用于一般性文档、报告、表格等"
    }
}


# ==================== 完整提示词库 ====================
PROMPT_LIBRARY = {
    # ===== 1. 商务合同 =====
    "商务合同": {
        "category": "商务类",
        "icon": "📄",
        "description": "处理采购合同、销售合同、服务协议等商务文档",
        "global_instruction": """使用简体中文，保持专业严谨的商务语言风格。
特别注意数字精度，金额、日期不要出错。
对模糊信息标注"不确定"，不要猜测。
追求100%准确率，宁可保守不要冒进。""",
        "template_prompt": """这是一份商务合同文档。请特别注意：

【合同主体信息】
1. 甲方/乙方公司全称（不能简写，必须完整）
2. 法定代表人姓名（不是联系人）
3. 统一社会信用代码（18位）
4. 注册地址（完整详细地址）
5. 联系人、联系电话、邮箱

【财务关键信息】
1. 合同金额（大写和小写都要提取）
2. 付款方式（如：预付30%、货到付款等）
3. 付款账期（如：30天、60天）
4. 开户行全称
5. 银行账号（不能有空格或横杠错误）
6. 税率（如：13%、6%）
7. 发票类型（增值税专用发票/普通发票）

【时间节点】
1. 合同签订日期（必须精确到日）
2. 合同生效日期
3. 交货日期/交货期（如：签订后30天内）
4. 验收期限
5. 质保期（如：12个月、18个月）
6. 合同有效期

【业务条款】
1. 产品/服务名称及规格
2. 数量和单位（如：100台、5000个）
3. 单价（精确到小数点）
4. 技术标准/质量标准
5. 交付地点（详细地址）
6. 运输方式及费用承担
7. 包装要求

【编号信息】
1. 合同编号（如：HT-2024-001）
2. 项目编号
3. PO号（采购订单号）
4. 订单编号

【违约与争议】
1. 违约责任条款中的具体金额或比例
2. 争议解决方式（如：仲裁、诉讼）
3. 管辖法院或仲裁委员会

【特别提醒】
- 金额数字不能出错，小数点位置要准确
- 日期格式保持一致
- 公司名称不能有错别字
- 账号不能多一位或少一位""",
        "use_cases": [
            "处理中英文混合的国际贸易合同",
            "识别复杂的分期付款条款",
            "提取多方签署的三方协议信息"
        ]
    },
    
    # ===== 2. 技术文档 =====
    "技术文档": {
        "category": "技术类",
        "icon": "⚙️",
        "description": "处理BOM清单、技术规格书、产品说明书等",
        "global_instruction": """中英文混合输出，技术术语保留英文。
特别注意数字精度，不要四舍五入。
保留所有原始格式和标点符号。
编号中的字母大小写保持原样。""",
        "template_prompt": """这是一份技术相关文档。请特别注意：

【物料/产品信息】
1. 物料编号（如：MTR-2024-0001）
2. 产品型号（如：SKY13286-359LF、STM32F103C8T6）
   - 保持完整，不要截断
   - 字母大小写、横杠、数字都要准确
3. 产品名称（中文/英文）
4. 品牌/制造商
5. 产地/原产国

【规格参数】（关键！）
1. 电气参数
   - 工作电压：如 5V±5%、3.3V
   - 工作电流：如 100mA、2.5A
   - 功率：如 10W、500mW
   - 频率：如 100MHz、2.4GHz
2. 物理参数
   - 尺寸：如 10mm×8mm×2mm
   - 重量：如 50g、2.5kg
   - 温度范围：如 -40℃~+85℃
   - 湿度范围：如 10%~90%RH
3. 性能参数
   - 精度：如 ±0.1%、±1LSB
   - 分辨率：如 12位、1920×1080
   - 灵敏度：如 -96dBm
   - 带宽：如 100Mbps、千兆

【版本与批次】
1. 硬件版本（如：V1.0、V2.3、Rev.A）
2. 软件版本（如：Firmware v3.2.1）
3. 生产批次（如：Batch-20240315）
4. 序列号（如：SN202403150001）

【数量与单位】（必须准确！）
1. 数量：1、10、100、1000
2. 单位：
   - 个、只、台、套、件
   - pcs、EA、SET
   - 米、千米、kg、g
   - 卷、盒、箱
3. 包装规格（如：50个/盒，10盒/箱）

【技术标准与认证】
1. 执行标准（如：GB/T xxxx-2020）
2. 认证信息（如：CE、FCC、RoHS、UL）
3. 防护等级（如：IP65、IP67）
4. 安全等级（如：Class I、Class II）

【物料清单（BOM）专用】
1. 行号/序号
2. 位号（如：R1、C25、U3）
3. 封装（如：0402、SOT-23、QFP-64）
4. 阻值/容值（如：10kΩ±1%、100μF/25V）
5. 替代料（如：可用 xxx 替代）

【特别提醒】
- 型号中的字母O和数字0要区分清楚
- 型号中的字母I和数字1要区分清楚
- 单位换算要准确（1A=1000mA）
- 温度符号℃不要写成°C或C
- 希腊字母要识别（如μ=微、Ω=欧姆）""",
        "use_cases": [
            "提取复杂的BOM清单",
            "识别精密仪器的技术参数",
            "处理多语言技术规格书"
        ]
    },
    
    # ===== 3. 医疗文档 =====
    "医疗文档": {
        "category": "专业类",
        "icon": "🏥",
        "description": "处理病历、检验报告、处方等医疗文档",
        "global_instruction": """使用简体中文，保持专业医疗术语准确性。
追求100%准确率，涉及患者信息、用药信息必须精确。
对不确定的信息标注"待核实"，绝不猜测。""",
        "template_prompt": """这是医疗相关文档。请特别注意：

【患者信息】（隐私敏感！）
1. 患者姓名（必须完全准确）
2. 性别、年龄、出生日期
3. 身份证号（18位，不能错一位）
4. 联系电话、紧急联系人
5. 家庭住址
6. 民族、职业、婚姻状况

【医疗信息】
1. 诊断结果（中文医学术语）
2. 症状描述
3. 既往病史
4. 过敏史（药物过敏、食物过敏）
5. 家族病史

【用药信息】（关键！）
1. 药品名称（通用名+商品名）
2. 规格（如：5mg/片、100ml/瓶）
3. 剂量（如：每次2片、每日3次）
4. 用法（口服、静脉注射、外用等）
5. 疗程（如：连续7天）

【检查检验】
1. 检查项目名称
2. 检查结果（数值+单位+参考范围）
3. 异常指标（标注↑↓）
4. 检查日期和时间

【医嘱与处置】
1. 医生姓名、职称
2. 科室名称
3. 医嘱内容
4. 注意事项

【特别提醒】
- 药品剂量不能错，关乎生命安全
- 过敏史必须完整提取
- 数值结果要包含单位和参考范围
- 医学术语不要简化或改写""",
        "use_cases": [
            "提取病历中的关键医疗信息",
            "整理复杂的检验报告数据",
            "识别手写处方内容"
        ]
    },
    
    # ===== 4. 学术论文 =====
    "学术论文": {
        "category": "专业类",
        "icon": "📚",
        "description": "处理学术论文、研究报告等",
        "global_instruction": """保持学术规范格式，中英文混合输出。
特别注意引用格式、作者信息的准确性。
数学公式、化学式保持原样。""",
        "template_prompt": """这是学术论文或研究文档。请注意：

【作者信息】
1. 作者姓名（全部作者，标注通讯作者*）
2. 作者单位（完整机构名称）
3. 通讯地址、邮编
4. Email地址

【论文基本信息】
1. 论文标题（中英文）
2. 关键词（中英文）
3. 摘要（中英文）
4. DOI号
5. 收稿日期、录用日期、发表日期
6. 卷号、期号、页码

【资助信息】
1. 基金项目名称
2. 项目编号（如：No.2023YFB1234567）
3. 资助机构

【引用格式】
1. 参考文献编号 [1]、[2]
2. 作者、标题、期刊、年份、页码
3. 引用格式要保持一致

【研究数据】
1. 实验参数（精确数值）
2. 统计数据（均值±标准差）
3. 显著性（p<0.05、p<0.01）
4. 样本量（n=30）

【图表信息】
1. 图表编号（图1、表2）
2. 图表标题
3. 图例说明
4. 数据来源

【特别要求】
- 保持学术规范格式
- 数学公式、化学式保持原样
- 希腊字母、上下标要准确
- 缩写首次出现要有全称""",
        "use_cases": [
            "整理论文中的引用文献",
            "提取实验数据和统计结果",
            "识别复杂的数学公式和化学式"
        ]
    },
    
    # ===== 5. 法律文书 =====
    "法律文书": {
        "category": "法律类",
        "icon": "⚖️",
        "description": "处理判决书、起诉书、律师函等法律文档",
        "global_instruction": """使用简体中文，保持法律专业术语准确性。
特别严谨，涉及当事人信息、金额、日期必须精确。
法律条款引用要完整。""",
        "template_prompt": """这是法律文书。请特别严谨：

【当事人信息】
1. 原告/被告/第三人完整名称
2. 法定代表人/负责人姓名
3. 住所地（完整法律地址）
4. 委托代理人（律师姓名、律所）

【案件信息】
1. 案号（如：(2024)京01民初001号）
2. 案由（如：买卖合同纠纷）
3. 诉讼请求（逐条提取）
4. 争议焦点

【事实与证据】
1. 事实发生时间、地点
2. 涉案金额（大写+小写）
3. 证据编号（证据1、证据2）
4. 证人证言

【法律条款】
1. 引用的法律名称（全称）
2. 具体条款（第XX条第X款）
3. 司法解释

【裁判结果】
1. 判决主文（逐条）
2. 诉讼费承担
3. 执行期限
4. 上诉期限

【特别提醒】
- 人名、公司名一个字都不能错
- 金额必须大小写一致
- 日期格式统一
- 法律条款引用要完整""",
        "use_cases": [
            "提取判决书中的关键信息",
            "整理合同纠纷的争议焦点",
            "识别复杂的法律条款引用"
        ]
    },
    
    # ===== 6. 财务报表 =====
    "财务报表": {
        "category": "财务类",
        "icon": "💰",
        "description": "处理资产负债表、利润表、现金流量表等",
        "global_instruction": """保持财务专业术语准确性。
金额数字必须精确到分，不能出错。
会计科目名称使用标准术语。""",
        "template_prompt": """这是财务报表。请注意：

【报表基本信息】
1. 公司全称
2. 报表类型（资产负债表/利润表/现金流量表）
3. 报表期间（2024年1-3月/2024年度）
4. 货币单位（元、万元、千元）

【科目与金额】
1. 会计科目名称（标准会计术语）
2. 期初余额
3. 本期发生额
4. 期末余额
5. 上年同期数（用于对比）

【财务指标】
1. 营业收入、净利润
2. 资产总额、负债总额
3. 毛利率、净利率（百分比）
4. 资产负债率
5. 现金流量净额

【附注信息】
1. 会计政策
2. 关联方交易
3. 或有事项
4. 重大事项说明

【审计信息】
1. 审计机构名称
2. 审计意见类型
3. 注册会计师签名
4. 审计报告日期

【特别要求】
- 金额数字必须准确到分
- 借贷方向不能搞错
- 合计数要核对
- 百分比保留小数位数一致""",
        "use_cases": [
            "提取财务报表中的关键指标",
            "对比不同期间的财务数据",
            "整理审计报告信息"
        ]
    },
    
    # ===== 7. 房地产文档 =====
    "房地产文档": {
        "category": "房产类",
        "icon": "🏠",
        "description": "处理房产证、购房合同、租赁合同等",
        "global_instruction": """特别注意面积、价格、地址等关键信息的准确性。
证件号码必须完整无误。""",
        "template_prompt": """这是房地产相关文档。请注意：

【房产信息】
1. 房产证号/不动产权证号
2. 房屋坐落（完整地址）
3. 建筑面积（精确到小数点）
4. 套内面积
5. 房屋用途（住宅/商业/办公）
6. 房屋结构（钢混/砖混）
7. 所在楼层/总楼层
8. 建筑年代

【权属信息】
1. 产权人姓名（共有人）
2. 产权份额（如：各占50%）
3. 使用期限（如：70年）
4. 土地性质（出让/划拨）
5. 抵押情况

【交易信息】
1. 成交价格（总价+单价/平米）
2. 付款方式（全款/按揭）
3. 首付金额、贷款金额
4. 贷款年限、月供
5. 过户时间
6. 交房时间

【税费信息】
1. 契税（金额+税率）
2. 个人所得税
3. 增值税
4. 中介费
5. 其他税费

【特别注意】
- 面积数字要准确
- 地址不能有错别字
- 价格小数点不能错位
- 证件号码完整无误""",
        "use_cases": [
            "提取房产证关键信息",
            "整理购房合同条款",
            "计算房产交易税费"
        ]
    },
    
    # ===== 8. 通用模板 =====
    "通用模板": {
        "category": "通用类",
        "icon": "📝",
        "description": "适用于一般性文档、报告、表格等",
        "global_instruction": """全面提取所有可变信息，不遗漏任何字段。
保持原有格式和表述风格。
对不确定的信息谨慎处理。""",
        "template_prompt": """这是一份通用文档。请全面提取信息：

【基本信息优先】
1. 人名/公司名（出现在文档中的所有实体）
2. 联系方式（电话、手机、传真、邮箱）
3. 地址信息（完整详细地址、邮编）
4. 日期信息（所有出现的日期）
5. 编号信息（文档编号、项目编号等）

【数值信息】
1. 金额（含货币符号：¥、$、€等）
2. 数量（含单位）
3. 百分比
4. 时间段（如：3个月、30天）
5. 比例、倍数

【标识信息】
1. 证件号码（身份证、护照、营业执照等）
2. 车牌号
3. 银行卡号
4. 统一社会信用代码
5. 其他编码

【描述性信息】
1. 产品/项目名称
2. 职位/部门
3. 学历/学位
4. 专业/领域
5. 资质/证书

【结构化数据】
1. 表格中的所有数据
2. 列表中的所有项目
3. 标题层级结构
4. 签名/盖章位置

【提取原则】
1. 宁可多提取，不要遗漏
2. 保持原文表述，不要改写
3. 不确定的信息也要提取，但标注"待确认"
4. 重复出现的信息只提取一次，但要记录出现次数
5. 注意上下文关系，正确理解信息含义""",
        "use_cases": [
            "处理各类一般性文档",
            "提取表格数据",
            "整理混合格式文档"
        ]
    }
}


# ==================== 全局指令类别 ====================
GLOBAL_INSTRUCTIONS = {
    "语言风格": {
        "繁体中文": "使用繁体中文輸出，保持專業嚴謹",
        "简体中文": "使用简体中文，通俗易懂的表达方式",
        "中英混合": "中英文混合输出，技术术语保留英文",
        "正式商务": "保持正式商务语言风格",
        "口语化": "使用口语化、轻松的表达方式"
    },
    "识别策略": {
        "关键信息优先": "优先识别日期、金额、联系方式等关键信息",
        "技术参数": "重点关注技术参数和型号信息",
        "数字精度": "特别注意数字精度，不要四舍五入",
        "不猜测": "对模糊信息标注'不确定'，不要猜测",
        "不遗漏": "宁可多提取信息，不要遗漏任何字段",
        "繁简转换": "遇到繁体字自动转换为简体字",
        "保留格式": "保留所有原始格式和标点符号"
    },
    "数据处理": {
        "金额格式": "金额保留两位小数，不要省略零",
        "电话格式": "电话号码保留所有横杠和空格",
        "日期格式": "日期统一格式为 YYYY-MM-DD",
        "百分比": "百分比保留%符号",
        "单位保留": "单位必须保留（如：个、台、pcs、kg）",
        "大小写": "编号中的字母大小写保持原样"
    },
    "质量要求": {
        "高准确率": "追求100%准确率，宁可保守不要冒进",
        "二次验证": "对关键信息进行二次验证",
        "标注矛盾": "遇到矛盾信息时标注出来",
        "完整度优先": "提取完整度优先于提取速度",
        "保持一致": "保持与原文档完全一致，不做任何改写"
    }
}


# ==================== 使用技巧和示例 ====================
USAGE_TIPS = {
    "组合使用示例": [
        {
            "场景": "处理港台繁体合同",
            "全局指令": "使用繁体中文輸出，保持專業嚴謹。金額統一用「元」，日期用「年月日」格式。",
            "模板": "商务合同",
            "效果": "适合处理港澳台地区的商务合同"
        },
        {
            "场景": "处理精密仪器BOM",
            "全局指令": "特别注意数字精度，保留所有小数位。型号中的字母O和数字0、字母I和数字1要严格区分。",
            "模板": "技术文档",
            "效果": "确保技术参数和型号的准确性"
        },
        {
            "场景": "处理医疗报告",
            "全局指令": "追求100%准确率，涉及患者姓名、药品剂量的信息必须二次确认。对不确定的信息标注'待核实'。",
            "模板": "医疗文档",
            "效果": "保证医疗信息的准确性和安全性"
        }
    ],
    "高级技巧": {
        "识别增强": [
            "遇到手写字迹，尽可能识别，不确定的标注[?]",
            "遇到模糊图片，根据上下文推测合理内容",
            "遇到表格，保持行列关系，用|分隔",
            "遇到印章，识别印章中的文字",
            "遇到水印，忽略水印提取实际内容"
        ],
        "特殊字符处理": [
            "全角/半角统一转换",
            "①②③序号转换为1、2、3",
            "Ⅰ、Ⅱ、Ⅲ转换为一、二、三",
            "√、×、☑识别为对应含义"
        ],
        "智能判断": [
            "根据上下文判断简称的全称",
            "根据格式判断数据类型（电话/邮编/金额）",
            "根据单位推断数值合理性",
            "识别数字中的OCR常见错误（0/O、1/I/l）"
        ],
        "质量控制": [
            "提取完成后自检：字段是否完整？数值是否合理？",
            "关键信息二次确认",
            "发现矛盾立即标注"
        ]
    }
}


# ==================== 辅助函数 ====================
def get_template_by_name(template_name):
    """根据名称获取模板"""
    return PROMPT_LIBRARY.get(template_name, None)


def get_all_template_names():
    """获取所有模板名称列表"""
    return list(PROMPT_LIBRARY.keys())


def get_templates_by_category(category):
    """根据类别获取模板列表"""
    return {
        name: info 
        for name, info in PROMPT_LIBRARY.items() 
        if info.get("category") == category
    }


def get_all_categories():
    """获取所有类别"""
    categories = set()
    for info in PROMPT_LIBRARY.values():
        categories.add(info.get("category", "其他"))
    return sorted(list(categories))


def build_enhanced_prompt(base_prompt, global_instruction="", template_name=""):
    """
    构建增强的提示词
    
    参数:
        base_prompt: 基础提示词
        global_instruction: 全局指令
        template_name: 模板名称
    
    返回:
        增强后的提示词
    """
    enhanced = base_prompt
    
    # 添加模板指令
    if template_name and template_name in PROMPT_LIBRARY:
        template_prompt = PROMPT_LIBRARY[template_name].get("template_prompt", "")
        if template_prompt:
            enhanced = f"""
【文档类型: {template_name}】
{template_prompt}

{enhanced}
"""
    
    # 添加全局指令
    if global_instruction and global_instruction.strip():
        enhanced = f"""
【全局指令】
{global_instruction.strip()}

{enhanced}
"""
    
    return enhanced


def get_quick_instructions():
    """获取快速指令组合"""
    quick_combos = []
    
    # 从全局指令中组合常用的
    for category, instructions in GLOBAL_INSTRUCTIONS.items():
        for name, instruction in instructions.items():
            quick_combos.append({
                "name": f"{category} - {name}",
                "instruction": instruction
            })
    
    return quick_combos